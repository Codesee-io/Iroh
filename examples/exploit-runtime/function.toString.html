<!--
  In this example we exploit function.toString
  so the original function string gets returned
  instead of the patched code
-->
<h3>Open your console ðŸ˜Š</h3>

<script>
  let code = `
    function main() { return 42; };
    console.log(
      main.toString(),
      // validate if we receive the original function string
      main.toString() === "function main() { return 42; }"
    );
  `;
</script>

<script type="text/javascript" src="../../dist/iroh.js"></script>
<script type="text/javascript">
let stage = new Iroh.Stage(code);
let listener = stage.addListener(Iroh.CALL)
listener.on("before", (e) => {
  if (
    e.object instanceof Function &&
    e.call === Function.toString
  ) {
    let name = e.object.name;
    let node = stage.getFunctionNodeByName(name);
    let input = stage.input; // this is our original input string
    let code = input.substr(node.start, node.end - node.start);
    e.call = () => code;
  }
});
eval(stage.script);
</script>
