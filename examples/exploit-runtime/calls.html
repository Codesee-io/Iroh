<!--
  In this example we exploit the code's original runtime behaviour
  by simply manipulating the data used while execution
-->
<script>
  let code = `
    function rnd() {
      return Math.random.apply(Math, arguments);
    }
    console.log(Math.random(), rnd());
  `;
</script>

<script type="text/javascript" src="../../dist/iroh.js"></script>
<script type="text/javascript">
let stage = new Iroh.Stage(code);
let listener = stage.addListener(Iroh.CALL)
listener.on("before", (e) => {
  if (
    (e.object === Math &&
    e.callee === "random") ||
    e.object === Math.random
  ) {
    e.call = () => 666;
  }
});
eval(stage.script);
</script>
